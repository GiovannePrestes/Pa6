@model IEnumerable<ControlePatrimonios.Models.TbBloco>

@{
    ViewData["Title"] = "Blocos";
}

<h2>Blocos</h2>
<div class="row">
    <div class="col-md-offset-2 col-md-8">
        <div align="right">
            <button class="btn btn-primary" onclick="onClickCriar()">Criar novo bloco</button>
        </div>
        <hr />
        <table class="table table-striped table-bordered">
            <thead>
                <tr class="bg-primary">
                    <th>
                        @Html.DisplayNameFor(model => model.NomeBloco)
                    </th>
                    <th width="275"></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>
                            @Html.DisplayFor(modelItem => item.NomeBloco)
                        </td>
                        <td align="right">
                            <button class="btn" onclick="Edit(@item.IdBloco)">Editar</button> |
                            <button class="btn" onclick="Details(@item.IdBloco)">Detalhes</button> |
                            <button class="btn" onclick="Delete(@item.IdBloco)">Excluir</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<script>
    function onClickCriar() {
        window.location.href = "./Bloco/Create";
    }
    function Edit(BlocoId) {
        window.location.href = "./Bloco/Edit/" + BlocoId;
    }
    function Details(BlocoId) {
        $.get("./Bloco/Details",
            {
                id: BlocoId
            })
            .done(function (result) {
                if (result.success)
                    swal({
                        title: "Detalhes",
                        text: "Nome do Bloco: " + result.message,
                        icon: "success"
                    });
            });
    }
    function Delete(BlocoId) {
        $.get("./Bloco/GetNomeBlocoById",
            {
                id: BlocoId
            })
            .done(function (resultNomeBloco) {
                swal({
                    title: "Tem certeza?",
                    text: "Você irá excluir o Bloco: '" + resultNomeBloco.message + "'",
                    icon: "warning",
                    buttons: true,
                    dangerMode: true
                })
                .then((excluir) => {
                    if (excluir) {
                        $.post("./Bloco/Delete",
                            {
                                id: BlocoId
                            })
                            .done(function (result) {
                                if (result.success) {
                                    swal({
                                        title: "Bloco '" + result.message + "' deletado com sucesso",
                                        icon: "success"
                                    }).then(() => {
                                        window.location.reload();
                                    });
                                } else {
                                    swal({
                                        title: "Atenção!",
                                        text: "O Bloco '" + result.message + "' tem objetos atrelados a ele, ao confirmar todos os objetos serão excluidos, deseja excluir mesmo assim?",
                                        icon: "warning",
                                        buttons: true,
                                        dangerMode: true,
                                    }).then((excluirMesmoAssim) =>
                                    {
                                        if (excluirMesmoAssim) {
                                            $.post("./Bloco/DeleteConfirmed",
                                                {
                                                    id: BlocoId
                                                })
                                                .done(function (result) {
                                                    if (result.success) {
                                                        swal({
                                                            text: "Bloco '" + result.message + "' deletado com sucesso",
                                                            icon: "success"
                                                        }).then(() => {
                                                            window.location.reload();
                                                        });
                                                    }
                                                })
                                                .fail(function () {
                                                    swal("", "Algo deu errado", "error")
                                                });
                                        }
                                    });
                                }
                            })
                            .fail(function () {
                                swal("", "Algo deu errado", "error")
                            });
                    } else {
                        swal({ title: "Bloco: '" + resultNomeBloco.message + "' não deletado"});
                    }
                });
            });
        
    }
</script>
