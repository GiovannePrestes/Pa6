@model IEnumerable<ControlePatrimonios.Models.TbEncerramento>

@{
    ViewData["Title"] = "Encerramentos";
}

<h2>Encerramentos</h2>
<div class="row">
    <div class="col-md-offset-1 col-md-10">
        <div align="right">
            <button class="btn btn-primary" onclick="onClickCriar()">Criar novo encerramento</button>
        </div>
        <hr />
        <table class="table table-striped table-bordered">
            <thead>
                <tr class="bg-primary">
                    <th>
                        @Html.DisplayNameFor(model => model.DataEncerramento)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.Motivo)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.IdItemNavigation)
                        <form asp-controller="Encerramento" asp-action="Index" method="get">
                            <input class="label-primary" type="text" name="search">
                            <input class="btn btn-primary" type="submit" value="Filtrar" />
                        </form>
                    </th>
                    <th width="175"></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>
                            @Html.DisplayFor(modelItem => item.DataEncerramento)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Motivo)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.IdItemNavigation.NomeItem)
                        </td>
                        <td align="right">
                            <button class="btn" onclick="Edit(@item.IdEncerramento)">Editar</button> |
                            <button class="btn" onclick="Details(@item.IdEncerramento)">Detalhes</button> @*|
        <button class="btn" onclick="Delete(@item.IdEncerramento)">Excluir</button>*@
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<script>
    function onClickCriar() {
        window.location.href = "@Url.Action("Create", "Encerramento")";
    }
    function Edit(EncerramentoId) {
        window.location.href = "@Url.Action("Edit", "Encerramento")/" + EncerramentoId;
    }
    function Details(EncerramentoId) {
        $.get("@Url.Action("Details", "Encerramento")",
            {
                id: EncerramentoId
            })
            .done(function (result) {
                if (result.success)
                    swal({
                        title: "Detalhes",
                        text: "Item do Encerramento: '" + result.message + "'",
                        icon: "success"
                    });
            });
    }
    function Delete(EncerramentoId) {
        $.get("@Url.Action("GetNomeItemEncerramentoById", "Encerramento")",
            {
                id: EncerramentoId
            })
            .done(function (resultNomeEncerramento) {
                if (resultNomeEncerramento.success) {
                    swal({
                        title: "Tem certeza?",
                        text: "Você irá excluir o Encerramento do Item: '" + resultNomeEncerramento.message + "'",
                        icon: "warning",
                        buttons: true,
                        dangerMode: true,
                    })
                        .then((excluir) => {
                            if (excluir) {
                                $.post("@Url.Action("Delete", "Encerramento")",
                                    {
                                        id: EncerramentoId
                                    })
                                    .done(function (result) {
                                        if (result.success)
                                            swal({
                                                title: "Encerramento do Item '" + result.message + "' deletado com sucesso",
                                                icon: "success"
                                            }).then(() => {
                                                window.location.reload();
                                            });
                                    })
                                    .fail(function () {
                                        swal("", "Algo deu errado", "error")
                                    });
                            } else {
                                swal({ title: "Encerramento do Item: '" + resultNomeEncerramento.message + "' não deletado" });
                            }
                        });
                } else {
                    swal("", "Erro ao encontrar Item", "error")
                }
            });

    }
</script>
