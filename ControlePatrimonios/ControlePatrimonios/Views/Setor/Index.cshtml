@model IEnumerable<ControlePatrimonios.Models.TbSetor>

@{
    ViewData["Title"] = "Index";
}

<h2>Index</h2>

<p>
    <a asp-action="Create">Create New</a>
</p>
<table class="table">
    <thead>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.NomeSetor)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.IdBlocoNavigation)
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.NomeSetor)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.IdBlocoNavigation.NomeBloco)
                </td>
                <td>
                    <button onclick="Edit(@item.IdSetor)">Editar</button> |
                    <button onclick="Details(@item.IdSetor)">Detalhes</button> |
                    <button onclick="Delete(@item.IdSetor)">Excluir</button>
                </td>
            </tr>
        }
    </tbody>
</table>

<script>


    function Details(SetorId) {
        $.get("./Setor/Details",
            {
                id: SetorId
            })
            .done(function (result) {
                if (result.success)
                    swal({
                        title: "Detalhes",
                        text: "Setor: " + result.message.nomeSetor + 
                            "\nBloco: " + result.message.nomeBloco,
                        icon: "success"
                    });
            });
    }


    function Delete(SetorId) {
        $.get("./Setor/GetNomeSetor",
            {
                id: SetorId
            })
            .done(function (resultNomeSetor) {
                swal({
                    title: "Tem certeza?",
                    text: "Você irá excluir o Setor: " + resultNomeSetor.message,
                    icon: "warning",
                    buttons: true,
                    dangerMode: true,
                    buttons: ["Não", "Sim"],
                })
                .then((excluir) => {
                    if (excluir) {
                        $.post("./Setor/DeleteConfirmed",
                            {
                                id: SetorId
                            })
                            .done(function (result) {
                                if (result.success)
                                    swal({
                                        title: "Bloco " + result.message + " deletado com sucesso",
                                        icon: "success"
                                    }).then(() => {
                                        window.location.reload();
                                    });
                            })
                            .fail(function () {
                                swal("Ooops!", "Algo deu errado", "error")
                            });
                    } else {
                        swal({text: "Bloco " + resultNomeSetor.message + " não foi deletado" });
                    }
                });
            });

    }


</script>

